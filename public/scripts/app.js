"use strict";var app=angular.module("YearbookApp",["infinite-scroll","ngAnimate","ui.router","restangular"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("app",{"abstract":!0,templateUrl:"../partials/app.html",controller:"AppCtrl"}).state("app.profiles",{url:"/",templateUrl:"..//partials/profile/grid.html",controller:"GridCtrl"}).state("app.profiles.item",{url:"profile/:id",templateUrl:"../partials/profile/item.html",controller:"ProfileCtrl"})}]),app.controller("AppCtrl",["$scope",function(t){var e={};t.toggle=function(t){e[t]=!e[t]},t.visible=function(t){return e[t]===!0?!0:!1}}]),app.controller("FilterCtrl",["$scope","Filter",function(t,e){e.fetch().then(function(e){t.filters=e})}]),app.config(["RestangularProvider",function(t){t.setBaseUrl("/api/v1/"),t.addResponseInterceptor(function(t){var e=t.data;return t.meta&&(e.meta=t.meta),e})}]),app.factory("Filter",["$q","Restangular",function(t,e){return{fetch:function(){return e.all("filter").getList()}}}]),app.factory("Profile",["$q","Restangular",function(t,e){var r={},n={currentPage:0,totalPages:1},a=!1;return{busy:function(){return a},getTotalPages:function(){return n.totalPages?n.totalPages:1},getCurrentPage:function(){return n.currentPage?n.currentPage:1},nextPage:function(){return n.currentPage<n.totalPages?n.currentPage+1:!1},fetch:function(t,r){if(!a){var o=this.nextPage();if(o)return a=!0,e.all("profile").getList({page:o}).then(function(e){e.meta&&(n.currentPage=e.meta.pagination.current_page,n.totalPages=e.meta.pagination.total_pages),t(e),a=!1},function(t){r(t),a=!1})}},find:function(n){var a=t.defer();return r[n]?(a.resolve(r[n]),a.promise):(e.one("profile",n).get().then(function(t){t.getList("answer").then(function(e){t.answers=e}),t.getList("portfolio").then(function(e){t.portfolio=e}),t.getList("network").then(function(e){t.network=e}),t.getList("socialmedia").then(function(e){t.socialmedia=e}),a.resolve(t),r[t.id]=t}),a.promise)}}}]),app.controller("GridCtrl",["$scope","Profile",function(t,e){t.profiles=[],t.$parent.profileVisible=!0,t.loadMore=function(t){e.fetch(function(e){angular.forEach(e,function(e){t.push(e)})})},t.loadMore(t.profiles)}]),app.controller("ProfileCtrl",["$scope","Profile","$stateParams",function(t,e,r){var n=r.id;e.find(n).then(function(e){t.profile=e})}]);var app=angular.module("underscore",[]);app.factory("_",[function(){return window._}]);
